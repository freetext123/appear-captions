<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step 1: AI Text Capture</title>
    <style>
        :root { --main: #ffa550; --bg: #121212; }
        body { background: var(--bg); color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .container { max-width: 500px; margin: auto; background: #1e1e1e; padding: 20px; border-radius: 15px; border: 2px solid #333; }
        video { width: 100%; border-radius: 10px; margin-bottom: 15px; background: #000; }
        textarea { width: 100%; height: 150px; background: #000; color: var(--main); border: 1px solid var(--main); border-radius: 10px; padding: 10px; font-size: 1.1rem; box-sizing: border-box; }
        .btn { background: var(--main); color: black; padding: 15px; border-radius: 30px; border: none; font-weight: bold; width: 100%; cursor: pointer; margin-top: 10px; font-size: 1rem; }
        #status { margin: 10px 0; font-size: 0.9rem; color: #888; }
    </style>
</head>
<body>

    <h1>AI Text Capture Test</h1>
    <div class="container">
        <input type="file" id="video-input" accept="video/*" style="display:none;">
        <button class="btn" onclick="document.getElementById('video-input').click()">LOAD VIDEO</button>
        <div id="status">Upload a video to start testing AI listening.</div>
        
        <video id="player" controls playsinline></video>
        
        <textarea id="output-text" placeholder="AI Transcript will appear here in real-time..."></textarea>
        
        <button id="listen-btn" class="btn" style="display:none; background:none; border: 2px solid var(--main); color: var(--main);">START AI LISTENING</button>
    </div>

    <script>
        const videoInput = document.getElementById('video-input');
        const player = document.getElementById('player');
        const outputText = document.getElementById('output-text');
        const listenBtn = document.getElementById('listen-btn');
        const status = document.getElementById('status');

        // Speech Recognition Engine Setup
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        
        recognition.continuous = true; // Keep listening
        recognition.interimResults = true; // Show text while speaking
        recognition.lang = 'en-US'; // You can change this to 'hi-IN' or others later

        videoInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                player.src = URL.createObjectURL(file);
                listenBtn.style.display = 'block';
                status.innerText = "Video Loaded. Put your volume up and click Start AI.";
            }
        };

        listenBtn.onclick = () => {
            try {
                recognition.start();
                player.play();
                listenBtn.innerText = "ðŸŽ¤ AI IS LISTENING...";
                status.innerText = "Listening to audio... keep it clear.";
            } catch (err) {
                console.error("Recognition already started or error:", err);
            }
        };

        recognition.onresult = (event) => {
            let finalText = "";
            for (let i = 0; i < event.results.length; i++) {
                finalText += event.results[i][0].transcript + " ";
            }
            outputText.value = finalText; // This updates the box with every word heard
        };

        recognition.onerror = (event) => {
            status.innerText = "Error: " + event.error + ". Try again.";
            listenBtn.innerText = "START AI LISTENING";
        };

        recognition.onend = () => {
            listenBtn.innerText = "START AI LISTENING";
            status.innerText = "Stopped listening.";
        };
    </script>
</body>
</html>